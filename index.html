<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fullscreen Turnstile</title>
  <style>
    /* Full-screen overlay */
    html,body{height:100%;margin:0}
    body.lock-scroll { overflow: hidden; }
    .overlay {
      position: fixed;
      inset: 0;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,0.85);
      z-index: 9999;
      padding: 20px;
      box-sizing: border-box;
    }

    .panel {
      max-width: 520px;
      width: 100%;
      background: #0b0b0b;
      color: #fff;
      border-radius: 12px;
      padding: 28px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      text-align: center;
    }

    .brand { font-size:18px; margin-bottom: 12px; opacity: .9; }
    .hint { font-size:14px; margin-bottom:18px; color: #cfcfcf; }
    .small { font-size:12px; color:#aaa; margin-top:12px; }

    /* keep the turnstile centered */
    .cf-turnstile { margin: 0 auto; }

    /* optional close (for testing) */
    .close-btn {
      position: absolute;
      top: 14px;
      right: 18px;
      background: transparent;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
      opacity: .8;
    }
  </style>
  <!-- Cloudflare Turnstile script (async/defer) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body class="lock-scroll">
  <!-- Fullscreen overlay with Turnstile -->
  <div id="turnstileOverlay" class="overlay" role="dialog" aria-modal="true" aria-label="Human verification overlay">
    <button class="close-btn" onclick="console.log('close pressed')" title="Close (for dev)">‚úï</button>
    <div class="panel" id="panel">
      <div class="brand">Verify you're human</div>
      <div class="hint">Complete the challenge below to continue to the site.</div>

      <!-- Turnstile widget. data-callback will be invoked on success -->
      <div
        class="cf-turnstile"
        data-sitekey="0x4AAAAAAB7cY2EjPNVQi8Ls"
        data-callback="onTurnstileSuccess"
        data-theme="dark"
      ></div>

      <div class="small">If you can't see the challenge, make sure third-party scripts are allowed.</div>
    </div>
  </div>

  <script>
    // Build DOCTYPE string without placing the literal "<!DOCTYPE html>" in the source
    const DOCTYPE_STRING = '<' + '!DOCTYPE html>';

    // This function will be called by Cloudflare Turnstile on successful verification.
    // The 'token' parameter is the Turnstile token string.
    function onTurnstileSuccess(token) {
      // token is available here. In production, send it to your server for validation.
      console.log('Turnstile success token:', token);

      // Example: Replace entire document with a new HTML page (starts with DOCTYPE).
const newHtml =
  '<!DOCTYPE html>\n' +
  '<html lang="en">\n' +
  '<head>\n' +
  '  <meta charset="utf-8" />\n' +
  '  <meta name="viewport" content="width=device-width, initial-scale=1" />\n' +
  '  <title>Grape ‚Ä¢ Quantum Audio Playground</title>\n' +
  '  <style>\n' +
  '    :root { --bg: #0f1020; --panel: #17182b; --ink: #e7e7ee; --muted: #a9a9c7; --accent: #8a2be2; --accent-2: #c084fc; --ok: #10b981; --warn: #f59e0b; --err: #ef4444; --radius: 16px; --shadow: 0 10px 25px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03); }\n' +
  '    html, body { height: 100%; }\n' +
  '    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Segoe UI Variable", "SF Pro Text", Arial, "Noto Sans", sans-serif; color: var(--ink); background: radial-gradient(1200px 600px at 20% -10%, rgba(138,43,226,.25), transparent), radial-gradient(1400px 800px at 120% 110%, rgba(192,132,252,.18), transparent), var(--bg); }\n' +
  '    .wrap { max-width: 1000px; margin: 0 auto; padding: 32px 20px 80px; }\n' +
  '    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 24px; }\n' +
  '    .brand { display: flex; align-items: center; gap: 14px; font-weight: 700; letter-spacing: .4px; }\n' +
  '    .logo { width: 40px; height: 40px; border-radius: 12px; display: grid; place-items: center; font-size: 22px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: var(--shadow); }\n' +
  '    .title { font-size: clamp(20px, 2.2vw, 28px); }\n' +
  '    .subtitle { color: var(--muted); font-weight: 500; }\n' +
  '    .grid { display: grid; grid-template-columns: 1.1fr .9fr; gap: 20px; }\n' +
  '    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }\n' +
  '    .card { background: rgba(23,24,43,.8); border: 1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); }\n' +
  '    .card h2 { margin: 0; padding: 20px 20px 0; font-size: 18px; letter-spacing: .3px; }\n' +
  '    .card p { color: var(--muted); margin: 8px 20px 0; }\n' +
  '    .card .body { padding: 16px 20px 20px; }\n' +
  '    .toolbar { display: flex; gap: 8px; flex-wrap: wrap; padding: 12px; border-bottom: 1px solid rgba(255,255,255,.06); background: linear-gradient(180deg, rgba(255,255,255,.03), transparent); border-top-left-radius: var(--radius); border-top-right-radius: var(--radius); }\n' +
  '    button, .btn { appearance: none; border: 0; padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; color: white; background: linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow: var(--shadow); transition: transform .06s ease, filter .2s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }\n' +
  '    button:hover, .btn:hover { filter: brightness(1.08); }\n' +
  '    button:active, .btn:active { transform: translateY(1px); }\n' +
  '    .ghost { background: rgba(255,255,255,.06); }\n' +
  '    pre { margin: 0; overflow: auto; max-height: 480px; padding: 18px 20px; line-height: 1.5; font-size: 13.5px; border-bottom-left-radius: var(--radius); border-bottom-right-radius: var(--radius); background: #0b0c18; color: #e8e8f3; border: 1px solid rgba(255,255,255,.06); }\n' +
  '    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }\n' +
  '    .status { display: flex; gap: 10px; align-items: center; padding: 14px 16px; border-radius: 12px; background: rgba(16,185,129,.1); border: 1px solid rgba(16,185,129,.35); color: #d1fae5; font-weight: 600; }\n' +
  '    .status span.dot { width: 10px; height: 10px; border-radius: 999px; background: var(--ok); box-shadow: 0 0 0 3px rgba(16,185,129,.25); display: inline-block; }\n' +
  '    details { margin: 8px 0; }\n' +
  '    summary { cursor: pointer; color: var(--muted); }\n' +
  '    ol.instructions { margin: 0 0 0 20px; }\n' +
  '    ol.instructions li { margin: 8px 0; }\n' +
  '    .small { font-size: 12px; color: var(--muted); }\n' +
  '  </style>\n' +
  '</head>\n' +
  '<body>\n' +
  '  <div class="wrap">\n' +
  '    <header>\n' +
  '      <div class="brand">\n' +
  '        <div class="logo">üçá</div>\n' +
  '        <div>\n' +
  '          <div class="title">Grape</div>\n' +
  '          <div class="subtitle">Quantum-audio demo powered by Audio2Vec + QPAM</div>\n' +
  '        </div>\n' +
  '      </div>\n' +
  '      <a class="btn" id="downloadHtml" download="grape.html" href="#">Download page</a>\n' +
  '    </header>\n' +
  '// Download the HTML itself\n' +
  '(function() {\n' +
  '  const a = document.getElementById("downloadHtml");\n' +
  '  const blob = new Blob([document.documentElement.outerHTML], { type: "text/html" });\n' +
  '  a.href = URL.createObjectURL(blob);\n' +
  '})();\n' +
  '\n' +
  '// Copy and download buttons for the embedded Python code\n' +
  'const codeEl = document.getElementById("pycode");\n' +
  'const copyBtn = document.getElementById("copyCode");\n' +
  'const dlBtn = document.getElementById("downloadCode");\n' +
  '\n' +
  'copyBtn.addEventListener("click", async () => {\n' +
  '  try {\n' +
  '    await navigator.clipboard.writeText(codeEl.textContent);\n' +
  '    copyBtn.textContent = "Copied!";\n' +
  '    setTimeout(() => (copyBtn.textContent = "Copy code"), 1200);\n' +
  '  } catch (e) {\n' +
  '    alert("Copy failed.");\n' +
  '  }\n' +
  '});\n' +
  '\n' +
  'dlBtn.addEventListener("click", () => {\n' +
  '  const blob = new Blob([codeEl.textContent], { type: "text/x-python" });\n' +
  '  const url = URL.createObjectURL(blob);\n' +
  '  const a = document.createElement("a");\n' +
  '  a.href = url;\n' +
  '  a.download = "https://github.com/eotter-beep/grape/archive/refs/heads/main.zip";\n' +
  '  document.body.appendChild(a);\n' +
  '  a.click();\n' +
  '  a.remove();\n' +
  '  URL.revokeObjectURL(url);\n' +
  '});'
  '</body>\n' +
  '</html>';
      // Replace the current document with the new HTML
      document.open();
      document.write(newHtml);
      document.close();

      // NOTE: after document.close(), any previously loaded JS/vars from this page are gone.
    }

    // Optional: focus management / trap keyboard while overlay open
    (function() {
      const overlay = document.getElementById('turnstileOverlay');
      // trap focus inside overlay for accessibility
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          // For dev only: allow closing with escape if you want (remove in production).
          // overlay.style.display = 'none';
          // document.body.classList.remove('lock-scroll');
          console.log('Esc pressed (overlay remains in demo)');
        }
      }, false);
    })();
  </script>
</body>
</html>

